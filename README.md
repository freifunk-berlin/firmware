# Freifunk Firmware Berlin

## Release Note 0.1.0 - codename kathleen

*[Kathleen Booth](https://en.wikipedia.org/wiki/Kathleen_Booth) was the author of the first assembly language*.

The purpose for this release is to have a stable firmware for beginners for the Freifunk mesh in Berlin.
The firmware itself is based on vanilla [OpenWRT](https://wiki.openwrt.org/start) Barrier Breaker with some modifications (to fix
broken stuff in OpenWRT itself or for example luci) and additional default packages/configuration settings.
New features like a new network concept will be part of future releases.

**Features**
* based on [OpenWRT](https://wiki.openwrt.org/start) Barrier Breaker release
* update OLSRD to v0.6.7.1
* new OLSR setup and configuration:
  * SmartGateway for gateway selection (e.g. honors uplink speed)
  * dynamic gateway plugin for uplink connectivity tests (gwcheck script removed)
  * freifunk-policyrouting fixed/patched for VPN03 setup
* new configuration [wizard](https://github.com/freifunk-berlin/packages-berlin/tree/master/utils/luci-app-ffwizard-berlin)
  * starts after first boot and guides new users through the configuration of the router
* monitoring of nodes through collectd
* frei.funk as local DNS entry for your router
  * you do not have to remember your IP to get access
* change default lan ip address to 192.168.42.1/24
  * avoids network collisions
* one dhcp network for APs and lan (bridged)
* remove of autoipv6 and use of ULA ipv6 prefixes
* new primary router target: TP-Link WDR 3500/3600/4300
* default dns servers:
  * 85.214.20.141 (FoeBud / Digital Courage)
  * 213.73.91.35 (CCC Berlin)
  * 194.150.168.168 (dns.as250.net)
  * 2001:4ce8::53 (as250)
  * 2001:910:800::12 (french data network - http://www.fdn.fr/)

For questions write a mail to <berlin@berlin.freifunk.net> or come to our weekly meetings.
If you find bugs please report them at: https://github.com/freifunk-berlin/firmware/issues

A tutorial on router configuration is available at
http://berlin.freifunk.net/participate/howto/. Currently only in German. We are
working on a translation.

## Info

For the Berlin Freifunk firmware we use vanilla OpenWRT with additional patches
and packages. The Makefile automates firmware
creation and apply patches / integrates custom freifunk packages. All custom
patches are located in *patches/* and all additional packages can be found at
http://github.com/freifunk-berlin/packages_berlin.

## Releases

Every release has a [semantic version number](http://semver.org) and a codename.
We name our releases after important female computer scientists, hackers, etc.
For inspiration please take a look at the related
[ticket](https://github.com/freifunk-berlin/firmware/issues/24).

Stable releases are hosted on the buildbot master instance:

[http://buildbot.berlin.freifunk.net/buildbot/stable/](http://buildbot.berlin.freifunk.net/buildbot/stable/)

## Development

### Prerequisites

* Be aware that you will spend *a few hours* waiting for the entire build. Most of this time is due to download attempts and repository cloning depending on your internet connection. 

* An *internet connection* is required during the build for downloads and further cloning of more repositories.
* You need *more than 10GB* to spare for the build (mine consumed 9.5 GB).


### Building all firmwares

To get the source and build the firmware locally use:

```
git clone https://github.com/freifunk-berlin/firmware.git
cd firmware
make
```


Then the ImageBuilder files end up in the directory `bin`. You can find the
actuall firmware generated by the ImageBuilder in `firmwares`.

### Required packages

Please take a look at the [openWrt documenation](http://wiki.openwrt.org/doc/howto/buildroot.exigence#examples.of.package.installations)
for a complete and uptodate list of packages for your operating system. Make
sure the list contains `quilt`. We use it for patch management.

#### Ubuntu/Debian

```
apt-get install git subversion build-essential libncurses5-dev zlib1g-dev gawk \
  unzip libxml-perl flex wget gawk libncurses5-dev gettext quilt python
```

### Continuous integration

The firmware is [built
automatically](http://buildbot.berlin.freifunk.net/one_line_per_build) by our [buildbot farm](http://buildbot.berlin.freifunk.net/buildslaves). If you have a bit of CPU+RAM+storage capacity on one of your servers, you can provide a buildbot slave (see [berlin-buildbot](https://github.com/freifunk/berlin-buildbot)).

### Patches with quilt

**Important:** all patches should be pushed upstream!

If a patch is not yet included upstream, it can be placed in the `patches` directory with the `quilt` tool. Please configure `quilt` as described in the [openwrt wiki](http://wiki.openwrt.org/doc/devel/patches) (which also provides a documentation of `quilt`).

#### Add, modify or delete a patch

In order to add, modify or delete a patch run:

```bash
make clean pre-patch
```
Then switch to the openwrt directory:

```bash
cd openwrt
```
Now you can use the `quilt` commands as described in the [openwrt wiki](http://wiki.openwrt.org/doc/devel/patches).

##### Example: add a patch

```bash
quilt push -a                 # apply all patches
quilt new 008-awesome.patch   # tell quilt to create a new patch
quilt edit somedir/somefile1  # edit files
quilt edit somedir/somefile2
quilt refresh                 # creates/updates the patch file
```

### Submitting patches

#### openwrt

Create a commit in the openwrt directory that contains your change. Use `git
format-patch` to create a patch:

```
git format-patch origin
```

Send a patch to the openwrt mailing list with `git send-email`:

```
git send-email \
  --to=openwrt-devel@lists.openwrt.org \
  --smtp-server=mail.foo.bar \
  --smtp-user=foo \
  --smtp-encryption=tls \
  0001-a-fancy-change.patch
```

Additional information: https://dev.openwrt.org/wiki/SubmittingPatches

### Creating a release

For a new release create a new branch. The branch name must be a semantic version
number. Make sure you change the codename and semantic version number in the
README and config files (./configs/*)

The buildbot will build the release and place the files in the stable direcotry
once you pushed the new branch to github.
